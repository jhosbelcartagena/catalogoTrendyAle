<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trendy Ale - Joyer√≠a de Lujo & Elegancia</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', 'Times New Roman', serif;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            min-height: 100vh;
            color: #2c3e50;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: #ecf0f1;
            padding: 3rem 0;
            text-align: center;
            box-shadow: 0 4px 20px rgba(44, 62, 80, 0.3);
        }

        .header h1 {
            font-size: 2.8rem;
            margin-bottom: 0.5rem;
            font-weight: 400;
            letter-spacing: 2px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            font-style: italic;
            letter-spacing: 1px;
        }

        .logo-corner {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
        }

        .corner-logo {
            width: 80px;
            height: auto;
            background: rgba(255,255,255,0.95);
            padding: 8px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 1px solid #bdc3c7;
            transition: all 0.3s ease;
        }

        .corner-logo:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .admin-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .admin-btn {
            background: linear-gradient(135deg, #8b4513 0%, #a0522d 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(139, 69, 19, 0.3);
            transition: all 0.3s ease;
            font-family: 'Georgia', serif;
        }

        .admin-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139, 69, 19, 0.4);
        }

        .sync-status {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 1000;
            background: rgba(255,255,255,0.95);
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 0.8rem;
            border: 1px solid #bdc3c7;
            transition: all 0.3s ease;
        }

        .sync-status.syncing {
            background: #f39c12;
            color: white;
        }

        .sync-status.synced {
            background: #27ae60;
            color: white;
        }

        .sync-status.error {
            background: #c0392b;
            color: white;
        }

        .admin-panel {
            background: white;
            margin: 2rem auto;
            max-width: 600px;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
            display: none;
            border: 1px solid #bdc3c7;
        }

        .admin-panel.active {
            display: block;
        }

        .admin-panel h3 {
            color: #2c3e50;
            margin-bottom: 1.5rem;
            text-align: center;
            font-size: 1.5rem;
            border-bottom: 2px solid #34495e;
            padding-bottom: 0.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
            color: #2c3e50;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #bdc3c7;
            border-radius: 4px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
            font-family: 'Georgia', serif;
        }

        .form-group input:focus {
            outline: none;
            border-color: #2c3e50;
        }

        .btn-primary {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            margin-top: 1rem;
            transition: transform 0.3s ease;
            font-family: 'Georgia', serif;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .filters {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            border: 1px solid #bdc3c7;
        }

        .filter-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .filter-btn {
            background: #ecf0f1;
            border: 2px solid #bdc3c7;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: #2c3e50;
            font-family: 'Georgia', serif;
        }

        .filter-btn:hover, .filter-btn.active {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            border-color: #2c3e50;
            transform: translateY(-2px);
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .product-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 8px 30px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            position: relative;
            border: 1px solid #ecf0f1;
        }

        .product-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }

        .product-image {
            width: 100%;
            height: 250px;
            object-fit: cover;
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
        }

        .product-info {
            padding: 1.5rem;
        }

        .product-name {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        .product-price {
            font-size: 1.4rem;
            color: #8b4513;
            font-weight: bold;
            margin-bottom: 1rem;
        }

        .product-category {
            background: #ecf0f1;
            color: #34495e;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 0.8rem;
            display: inline-block;
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .edit-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid #bdc3c7;
            padding: 8px;
            border-radius: 4px;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .product-card:hover .edit-btn {
            opacity: 1;
        }

        .admin-mode .edit-btn {
            opacity: 1;
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 2rem;
        }

        .page-btn {
            background: white;
            border: 2px solid #bdc3c7;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #2c3e50;
            font-family: 'Georgia', serif;
        }

        .page-btn:hover, .page-btn.active {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            border-color: #2c3e50;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid #bdc3c7;
        }

        .close-btn {
            float: right;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #7f8c8d;
        }

        .btn-delete {
            background: #c0392b;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 1rem;
            font-family: 'Georgia', serif;
        }

        .cart-icon {
            position: fixed;
            top: 80px;
            right: 20px;
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .cart-icon:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4);
        }

        .cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #c0392b;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .add-to-cart-btn {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            transition: all 0.3s ease;
            margin-top: 10px;
            font-family: 'Georgia', serif;
        }

        .add-to-cart-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }

        .cart-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .cart-modal.active {
            display: flex;
        }

        .cart-content {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid #bdc3c7;
        }

        .cart-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid #ecf0f1;
            gap: 1rem;
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .cart-item-image {
            width: 60px;
            height: 60px;
            border-radius: 4px;
            object-fit: cover;
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-name {
            font-weight: bold;
            margin-bottom: 5px;
            color: #2c3e50;
        }

        .cart-item-price {
            color: #8b4513;
            font-weight: bold;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quantity-btn {
            background: #ecf0f1;
            border: 1px solid #bdc3c7;
            width: 30px;
            height: 30px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            color: #2c3e50;
        }

        .quantity-btn:hover {
            background: #d5dbdb;
        }

        .quantity-display {
            min-width: 30px;
            text-align: center;
            font-weight: bold;
            color: #2c3e50;
        }

        .cart-total {
            text-align: center;
            margin: 1.5rem 0;
            font-size: 1.4rem;
            font-weight: bold;
            color: #2c3e50;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #ecf0f1;
        }

        .whatsapp-btn {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            font-family: 'Georgia', serif;
        }

        .whatsapp-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4);
        }

        .empty-cart {
            text-align: center;
            padding: 2rem;
            color: #7f8c8d;
            font-style: italic;
        }

        .config-section {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border: 1px solid #ecf0f1;
        }

        .config-section h4 {
            margin-bottom: 1rem;
            color: #2c3e50;
            border-bottom: 1px solid #bdc3c7;
            padding-bottom: 0.5rem;
        }

        .setup-instructions {
            background: #e8f4fd;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 4px solid #3498db;
        }

        .setup-instructions h4 {
            color: #2980b9;
            margin-bottom: 1rem;
        }

        .setup-instructions ol {
            margin-left: 1.5rem;
            color: #34495e;
        }

        .setup-instructions li {
            margin-bottom: 0.5rem;
        }

        .setup-instructions code {
            background: #34495e;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }

        @media (max-width: 768px) {
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 1rem;
            }

            .header h1 {
                font-size: 2.2rem;
            }

            .filter-buttons {
                justify-content: flex-start;
                overflow-x: auto;
                padding-bottom: 10px;
            }

            .sync-status {
                display: none;
            }
        }
    </style>
</head>

<body>
    <script src="/socket.io/socket.io.js"></script>

    <div class="logo-corner">
        <img src="https://ideogram.ai/assets/progressive-image/balanced/response/AxAWAxaqQ-CAcRKyg6mVbQ" alt="Trendy Ale" class="corner-logo">
    </div>

    <div class="admin-toggle">
        <button class="admin-btn" onclick="toggleAdminMode()">üë®‚Äçüíº Admin</button>
    </div>

    <div class="sync-status" id="syncStatus">
        üíæ Local
    </div>

    <div class="cart-icon" onclick="toggleCart()">
        üõí
        <div class="cart-count" id="cartCount" style="display: none;">0</div>
    </div>

    <div class="header">
        <h1>üíé Trendy Ale</h1>
        <p>Joyer√≠a de Lujo & Elegancia</p>
    </div>

    <div class="admin-panel" id="adminPanel">
        <h3>‚öôÔ∏è Configuraci√≥n de la Tienda</h3>

        <div class="setup-instructions">
            <h4>üöÄ Configuraci√≥n de Sincronizaci√≥n (Opcional)</h4>
            <p><strong>Para sincronizar cambios entre todos los usuarios:</strong></p>
            <ol>
                <li>Ve a <code>jsonbin.io</code></li>
                <li>Crea una cuenta gratuita</li>
                <li>Crea un nuevo "bin"</li>
                <li>Copia tu API Key y Bin ID aqu√≠ abajo</li>
                <li>Los cambios se sincronizar√°n autom√°ticamente</li>
            </ol>
            <p><small>üí° <strong>Sin configurar:</strong> Solo funciona localmente en cada navegador</small></p>
        </div>

        <div class="config-section">
            <h4>üîÑ Sincronizaci√≥n Online</h4>
            <div class="form-group">
                <label>JSONBin.io API Key:</label>
                <input type="text" id="apiKey" placeholder="$2a$10$..." 
                       title="Obt√©n tu API key gratis en jsonbin.io">
            </div>
            <div class="form-group">
                <label>Bin ID:</label>
                <input type="text" id="binId" placeholder="67891234567890abcdef" 
                       title="ID del bin donde se guardar√°n los datos">
            </div>
            <button onclick="testConnection()" class="btn-primary" style="width:auto; margin-right:10px;">
                üîó Probar Conexi√≥n
            </button>
            <button onclick="syncNow()" class="btn-primary" style="width:auto;">
                üîÑ Sincronizar Ahora
            </button>
        </div>

        <div class="config-section">
            <h4>üì± Configuraci√≥n de WhatsApp</h4>
            <div class="form-group">
                <label>N√∫mero de WhatsApp (con c√≥digo de pa√≠s):</label>
                <input type="text" id="whatsappNumber" placeholder="573242821055" value="573242821055">
                <small style="color: #7f8c8d;">Ejemplo: 573242821055 (sin + ni espacios)</small>
            </div>
        </div>

        <div class="config-section">
            <h4>‚ûï Agregar Nueva Joya</h4>
            <form id="productForm">
                <div class="form-group">
                    <label>Nombre del producto:</label>
                    <input type="text" id="productName" required>
                </div>
                <div class="form-group">
                    <label>Precio:</label>
                    <input type="number" id="productPrice" step="0.01" required>
                </div>
                <div class="form-group">
                    <label>URL de la imagen:</label>
                    <input type="url" id="productImage" placeholder="https://ejemplo.com/imagen.jpg">
                </div>
                <div class="form-group">
                    <label>O subir imagen desde tu equipo:</label>
                    <input type="file" id="productImageFile" accept="image/*">
                </div>
                <div class="form-group">
                    <label>Categor√≠a:</label>
                    <input type="text" id="productCategory" required>
                </div>
                <div class="form-group">
                    <label>Descripci√≥n:</label>
                    <input type="text" id="productDescription" maxlength="200">
                </div>
                <button type="submit" class="btn-primary">Agregar Producto</button>
            </form>
        </div>
    </div>

    <div class="container">
        <div class="filters">
            <div class="filter-buttons">
                <button class="filter-btn active" onclick="filterProducts('all')">Todos</button>
                <button class="filter-btn" onclick="filterProducts('anillos')">Anillos</button>
                <button class="filter-btn" onclick="filterProducts('collares')">Collares</button>
                <button class="filter-btn" onclick="filterProducts('aretes')">Aretes</button>
                <button class="filter-btn" onclick="filterProducts('pulseras')">Pulseras</button>
                <button class="filter-btn" onclick="filterProducts('relojes')">Relojes</button>
                <button class="filter-btn" onclick="filterProducts('cadenas')">Cadenas</button>
                <button class="filter-btn" onclick="filterProducts('dijes')">Dijes</button>
            </div>
        </div>

        <div class="products-grid" id="productsGrid">
            <!-- Los productos se cargar√°n din√°micamente -->
        </div>

        <div class="pagination" id="pagination">
            <!-- La paginaci√≥n se generar√° din√°micamente -->
        </div>
    </div>

    <!-- Modal para el carrito -->
    <div class="cart-modal" id="cartModal">
        <div class="cart-content">
            <button class="close-btn" onclick="closeCart()">&times;</button>
            <h3>üõí Mi Carrito de Compras</h3>
            <div id="cartItems">
                <!-- Los items del carrito se cargar√°n aqu√≠ -->
            </div>
            <div class="cart-total" id="cartTotal" style="display: none;">
                Total: $0.00
            </div>
            <div id="cartActions" style="display: none;">
                <button class="whatsapp-btn" onclick="sendToWhatsApp()">
                    üí¨ Enviar Pedido por WhatsApp
                </button>
            </div>
        </div>
    </div>

    <!-- Modal para editar productos -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeEditModal()">&times;</button>
            <h3>‚úèÔ∏è Editar Producto</h3>
            <form id="editForm">
                <input type="hidden" id="editProductId">
                <div class="form-group">
                    <label>Nombre del producto:</label>
                    <input type="text" id="editProductName" required>
                </div>
                <div class="form-group">
                    <label>Precio:</label>
                    <input type="number" id="editProductPrice" step="0.01" required>
                </div>
                <div class="form-group">
                    <label>URL de la imagen:</label>
                    <input type="url" id="editProductImage">
                </div>
                <div class="form-group">
                    <label>O subir imagen desde tu equipo:</label>
                    <input type="file" id="editProductImageFile" accept="image/*">
                </div>
                <div class="form-group">
                    <label>Categor√≠a:</label>
                    <input type="text" id="editProductCategory" required>
                </div>
                <div class="form-group">
                    <label>Descripci√≥n:</label>
                    <input type="text" id="editProductDescription" maxlength="200">
                </div>
                <button type="submit" class="btn-primary">Guardar Cambios</button>
                <button type="button" class="btn-delete" onclick="deleteProduct()">Eliminar Producto</button>
            </form>
        </div>
    </div>

    <!-- Modal de login admin -->
    <div class="modal" id="adminLoginModal">
        <div class="modal-content" style="max-width:350px;">
            <button class="close-btn" onclick="closeAdminLogin()">&times;</button>
            <h3>üîí Acceso Administrador</h3>
            <form id="adminLoginForm">
                <div class="form-group">
                    <label>Usuario:</label>
                    <input type="text" id="adminUser" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label>Contrase√±a:</label>
                    <input type="password" id="adminPass" required autocomplete="current-password">
                </div>
                <button type="submit" class="btn-primary">Ingresar</button>
            </form>
            <div id="adminLoginError" style="color:#c0392b; margin-top:10px; display:none;">Usuario o clave incorrectos</div>
        </div>
    </div>

<script>
    // --- CONFIGURACI√ìN BASE DE DATOS LOCAL ---
    let isOnlineMode = true; // Ahora se refiere a la base de datos local del servidor

    // --- DATOS INICIALES CON CAT√ÅLOGO AMPLIO ---
    let products = [
        // ANILLOS
        {
            id: 1,
            name: "Anillo Solitario Diamante 1ct",
            price: 2850000,
            image: "https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=300&h=250&fit=crop",
            category: "anillos",
            description: "Elegante solitario en oro blanco 18k con diamante certificado de 1 quilate"
        },
        {
            id: 2,
            name: "Anillo Compromiso Halo",
            price: 1950000,
            image: "https://images.unsplash.com/photo-1603561591411-07134e71a2a9?w=300&h=250&fit=crop",
            category: "anillos",
            description: "Anillo halo con diamante central y pav√© de diamantes en oro rosa 14k"
        },
        {
            id: 3,
            name: "Anillo Eternidad Diamantes",
            price: 1250000,
            image: "https://images.unsplash.com/photo-1605100804763-247f67b3557e?w=300&h=250&fit=crop",
            category: "anillos",
            description: "Banda de eternidad con diamantes continuos en oro blanco 18k"
        },
        {
            id: 4,
            name: "Anillo Vintage Esmeralda",
            price: 2200000,
            image: "https://images.unsplash.com/photo-1506622909577-8f5439119241?w=300&h=250&fit=crop",
            category: "anillos",
            description: "Anillo vintage con esmeralda colombiana y diamantes laterales"
        },

        // COLLARES
        {
            id: 5,
            name: "Collar Rivi√®re Diamantes",
            price: 4500000,
            image: "https://images.unsplash.com/photo-1599643478518-a784e5dc4c8f?w=300&h=250&fit=crop",
            category: "collares",
            description: "Collar rivi√®re con diamantes graduados en oro blanco 18k"
        },
        {
            id: 6,
            name: "Collar Perlas Australianas",
            price: 3200000,
            image: "https://images.unsplash.com/photo-1506630448388-4e683c67ddb0?w=300&h=250&fit=crop",
            category: "collares",
            description: "Collar de perlas australianas con cierre de oro y diamantes"
        },
        {
            id: 7,
            name: "Collar Tenis Diamantes",
            price: 2800000,
            image: "https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=300&h=250&fit=crop",
            category: "collares",
            description: "Collar tenis con diamantes perfectamente alineados"
        },
        {
            id: 8,
            name: "Collar Choker Oro Rosa",
            price: 850000,
            image: "https://images.unsplash.com/photo-1611591437281-460bfbe1220a?w=300&h=250&fit=crop",
            category: "collares",
            description: "Choker moderno en oro rosa 14k con acabado satinado"
        },

        // ARETES
        {
            id: 9,
            name: "Aretes Gota Diamante",
            price: 1850000,
            image: "https://images.unsplash.com/photo-1635767582909-78bb30f68e7d?w=300&h=250&fit=crop",
            category: "aretes",
            description: "Aretes en forma de gota con diamantes y cierre de presi√≥n"
        },
        {
            id: 10,
            name: "Aretes Candelabro Vintage",
            price: 2400000,
            image: "https://images.unsplash.com/photo-1588444650733-5c2aae136b2d?w=300&h=250&fit=crop",
            category: "aretes",
            description: "Aretes estilo candelabro con m√∫ltiples diamantes en oro amarillo"
        },
        {
            id: 11,
            name: "Aretes Topo Diamante",
            price: 650000,
            image: "https://images.unsplash.com/photo-1617038220319-276d3cfab638?w=300&h=250&fit=crop",
            category: "aretes",
            description: "Aretes tipo topo con diamantes solitarios en oro blanco 18k"
        },
        {
            id: 12,
            name: "Aretes Argolla Diamantes",
            price: 1350000,
            image: "https://images.unsplash.com/photo-1601821765780-754fa98637c1?w=300&h=250&fit=crop",
            category: "aretes",
            description: "Argollas medianas con pav√© de diamantes en oro rosa"
        },

        // PULSERAS
        {
            id: 13,
            name: "Pulsera Tenis Diamantes",
            price: 3200000,
            image: "https://images.unsplash.com/photo-1611591437281-460bfbe1220a?w=300&h=250&fit=crop",
            category: "pulseras",
            description: "Pulsera tenis con diamantes de talla brillante en oro blanco"
        },
        {
            id: 14,
            name: "Pulsera Cartier Love",
            price: 2850000,
            image: "https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=300&h=250&fit=crop",
            category: "pulseras",
            description: "Pulsera estilo Love en oro rosa 18k con tornillos"
        },
        {
            id: 15,
            name: "Pulsera Charm Oro",
            price: 950000,
            image: "https://images.unsplash.com/photo-1588444650733-5c2aae136b2d?w=300&h=250&fit=crop",
            category: "pulseras",
            description: "Pulsera con dijes intercambiables en oro amarillo 14k"
        },
        {
            id: 16,
            name: "Pulsera Perlas Tahit√≠",
            price: 1750000,
            image: "https://images.unsplash.com/photo-1506630448388-4e683c67ddb0?w=300&h=250&fit=crop",
            category: "pulseras",
            description: "Pulsera con perlas de Tahit√≠ y cierre de oro con diamantes"
        },

        // RELOJES
        {
            id: 17,
            name: "Reloj Cartier Tank",
            price: 8500000,
            image: "https://images.unsplash.com/photo-1524805444758-089113d48a6d?w=300&h=250&fit=crop",
            category: "relojes",
            description: "Reloj Cartier Tank en oro rosa con correa de cocodrilo"
        },
        {
            id: 18,
            name: "Reloj Rolex Datejust",
            price: 12500000,
            image: "https://images.unsplash.com/photo-1533139502658-0198f920d8e8?w=300&h=250&fit=crop",
            category: "relojes",
            description: "Rolex Datejust en acero y oro con esfera de diamantes"
        },
        {
            id: 19,
            name: "Reloj Omega Constellation",
            price: 4500000,
            image: "https://images.unsplash.com/photo-1522312346375-d1a52e2b99b3?w=300&h=250&fit=crop",
            category: "relojes",
            description: "Omega Constellation con diamantes en bisel y esfera"
        },
        {
            id: 20,
            name: "Reloj Patek Philippe",
            price: 18000000,
            image: "https://images.unsplash.com/photo-1594534475808-b18fc33b044e?w=300&h=250&fit=crop",
            category: "relojes",
            description: "Patek Philippe Calatrava en oro blanco, edici√≥n limitada"
        },

        // CADENAS
        {
            id: 21,
            name: "Cadena Figaro Oro",
            price: 1250000,
            image: "https://images.unsplash.com/photo-1611591437281-460bfbe1220a?w=300&h=250&fit=crop",
            category: "cadenas",
            description: "Cadena Figaro en oro amarillo 18k, eslab√≥n ancho"
        },
        {
            id: 22,
            name: "Cadena Veneziana",
            price: 850000,
            image: "https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=300&h=250&fit=crop",
            category: "cadenas",
            description: "Cadena veneziana en oro blanco con acabado brillante"
        },
        {
            id: 23,
            name: "Cadena Barbada Plata",
            price: 350000,
            image: "https://images.unsplash.com/photo-1588444650733-5c2aae136b2d?w=300&h=250&fit=crop",
            category: "cadenas",
            description: "Cadena barbada en plata 925 con ba√±o de rodio"
        },
        {
            id: 24,
            name: "Cadena Singapur Oro Rosa",
            price: 950000,
            image: "https://images.unsplash.com/photo-1599643478518-a784e5dc4c8f?w=300&h=250&fit=crop",
            category: "cadenas",
            description: "Cadena Singapur en oro rosa 14k con cierre de seguridad"
        },

        // DIJES
        {
            id: 25,
            name: "Dije Coraz√≥n Diamantes",
            price: 750000,
            image: "https://images.unsplash.com/photo-1635767582909-78bb30f68e7d?w=300&h=250&fit=crop",
            category: "dijes",
            description: "Dije en forma de coraz√≥n con pav√© de diamantes"
        },
        {
            id: 26,
            name: "Dije Cruz Oro Blanco",
            price: 650000,
            image: "https://images.unsplash.com/photo-1617038220319-276d3cfab638?w=300&h=250&fit=crop",
            category: "dijes",
            description: "Dije cruz en oro blanco 18k con acabado satinado"
        },
        {
            id: 27,
            name: "Dije Mariposa Esmalte",
            price: 450000,
            image: "https://images.unsplash.com/photo-1601821765780-754fa98637c1?w=300&h=250&fit=crop",
            category: "dijes",
            description: "Dije mariposa con esmalte colorido y detalles en oro"
        },
        {
            id: 28,
            name: "Dije Inicial Personalizada",
            price: 350000,
            image: "https://images.unsplash.com/photo-1506622909577-8f5439119241?w=300&h=250&fit=crop",
            category: "dijes",
            description: "Dije con inicial personalizada en oro amarillo con diamantes"
        }
    ];

    let currentFilter = 'all';
    let currentPage = 1;
    const productsPerPage = 6;
    let isAdminMode = false;
    let editingProductId = null;
    let cart = [];
    let whatsappNumber = '573242821055';

    // --- CONFIGURACI√ìN SOCKET.IO ---
    const socket = io(); // Con√©ctate al servidor Socket.IO

    socket.on('connect', () => {
        console.log('Conectado al servidor Socket.IO');
        updateSyncStatus('synced', 'üåê Conectado');
    });

    socket.on('disconnect', () => {
        console.log('Desconectado del servidor Socket.IO');
        updateSyncStatus('error', 'üåê Desconectado');
    });

    // Escuchar actualizaciones de productos desde el servidor
    socket.on('productUpdate', (updatedProducts) => {
        console.log('Actualizaci√≥n de productos recibida:', updatedProducts);
        products = updatedProducts;
        renderProducts();
        renderPagination();
    });

    // --- FUNCIONES DE SINCRONIZACI√ìN CON BASE DE DATOS LOCAL ---
    function updateSyncStatus(status, message) {
        const syncStatus = document.getElementById('syncStatus');
        syncStatus.className = 'sync-status ' + status;
        syncStatus.innerHTML = message;
    }

    async function saveToDatabase() {
        // Esta funci√≥n ahora se encarga de enviar los cambios al servidor a trav√©s de WebSockets
        updateSyncStatus('syncing', 'üîÑ Enviando...');

        const data = {
            products: products,
            whatsappNumber: whatsappNumber
        };

        // Emitir el evento 'updateData' al servidor
        socket.emit('updateData', data, (ack) => {
            if (ack.success) {
                console.log('Datos enviados correctamente:', ack.message);
                updateSyncStatus('synced', '‚úÖ Enviado');
                setTimeout(() => updateSyncStatus('', 'üíæ Servidor'), 2000);
            } else {
                console.error('Error enviando datos:', ack.message);
                updateSyncStatus('error', '‚ùå Error env√≠o');
                setTimeout(() => updateSyncStatus('', 'üíæ Local'), 3000);
            }
        });
    }

    async function loadFromDatabase() {
        // Solicitar datos al servidor al cargar la p√°gina
        updateSyncStatus('syncing', 'üì• Solicitando...');
        socket.emit('requestData', (data) => {
            if (data.products && data.products.length > 0) {
                products = data.products;
                if (data.whatsappNumber) {
                    whatsappNumber = data.whatsappNumber;
                    document.getElementById('whatsappNumber').value = whatsappNumber;
                }
                updateSyncStatus('synced', '‚úÖ Recibido');
                setTimeout(() => updateSyncStatus('', 'üíæ Servidor'), 2000);
                renderProducts();
                renderPagination();
            } else {
                console.error('No se recibieron datos del servidor.');
                updateSyncStatus('error', '‚ùå Sin datos');
                setTimeout(() => updateSyncStatus('', 'üíæ Local'), 3000);
            }
        });
    }

    async function testConnection() {
        alert('La funci√≥n de prueba de conexi√≥n ha sido reemplazada por la sincronizaci√≥n en tiempo real v√≠a Socket.IO.');
    }

    async function syncNow() {
        loadFromDatabase();
        alert('Sincronizando datos del servidor...');
    }

    // --- ALMACENAMIENTO LOCAL (FALLBACK) ---
    function saveDataToStorage() {
        const data = {
            products: products,
            whatsappNumber: whatsappNumber
        };
        localStorage.setItem('trendyale_data', JSON.stringify(data));
    }

    function loadDataFromStorage() {
        const data = localStorage.getItem('trendyale_data');
        if (data) {
            const parsed = JSON.parse(data);
            if (parsed.products && parsed.products.length > 0) {
                products = parsed.products;
            }
            if (parsed.whatsappNumber) {
                whatsappNumber = parsed.whatsappNumber;
                document.getElementById('whatsappNumber').value = whatsappNumber;
            }
            updateSyncStatus('', 'üíæ Local'); // Actualizar estado si se carg√≥ desde local
        }
    }

    // Funci√≥n modificada para guardar datos
    async function saveData() {
        saveDataToStorage(); // Siempre guardar localmente como respaldo
        await saveToDatabase(); // Enviar al servidor v√≠a Socket.IO
    }

    function updateAdminButton() {
        const btn = document.querySelector('.admin-btn');
        btn.textContent = isAdminMode ? "üö™ Salir Admin" : "üë®‚Äçüíº Admin";
    }

    function toggleAdminMode() {
        if (!isAdminMode) {
            document.getElementById('adminLoginModal').classList.add('active');
            setTimeout(() => document.getElementById('adminUser').focus(), 100);
        } else {
            isAdminMode = false;
            document.getElementById('adminPanel').classList.remove('active');
            document.body.classList.remove('admin-mode');
            updateAdminButton();
            renderProducts(); // Re-renderizar para quitar botones de edici√≥n
        }
    }

    function filterProducts(category) {
        currentFilter = category;
        currentPage = 1;
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        event.target.classList.add('active');
        renderProducts();
        renderPagination();
    }

    function getFilteredProducts() {
        if (currentFilter === 'all') {
            return products;
        }
        return products.filter(product => product.category === currentFilter);
    }

    function renderProducts() {
        const filteredProducts = getFilteredProducts();
        const startIndex = (currentPage - 1) * productsPerPage;
        const endIndex = startIndex + productsPerPage;
        const currentProducts = filteredProducts.slice(startIndex, endIndex);

        const grid = document.getElementById('productsGrid');
        grid.innerHTML = currentProducts.map(product => `
            <div class="product-card">
                <img src="${product.image}" alt="${product.name}" class="product-image" 
                     onerror="this.src='https://via.placeholder.com/280x250/f0f0f0/999?text=Imagen+no+disponible'">
                <div class="product-info">
                    <div class="product-category">${product.category}</div>
                    <div class="product-name">${product.name}</div>
                    <div class="product-description" style="color:#555; font-size:0.95em; margin-bottom:0.5rem;">
                        ${product.description ? product.description : ""}
                    </div>
                    <div class="product-price">${product.price.toLocaleString('es-CO', {minimumFractionDigits: 2})}</div>
                    <button class="add-to-cart-btn" onclick="addToCart(${product.id})">
                        üõí Agregar al Carrito
                    </button>
                </div>
                ${isAdminMode ? `<button class="edit-btn" onclick="openEditModal(${product.id})">‚úèÔ∏è</button>` : ''}
            </div>
        `).join('');
    }

    function renderPagination() {
        const filteredProducts = getFilteredProducts();
        const totalPages = Math.ceil(filteredProducts.length / productsPerPage);

        if (totalPages <= 1) {
            document.getElementById('pagination').innerHTML = '';
            return;
        }

        let paginationHTML = '';

        for (let i = 1; i <= totalPages; i++) {
            paginationHTML += `
                <button class="page-btn ${i === currentPage ? 'active' : ''}" 
                        onclick="changePage(${i})">${i}</button>
            `;
        }

        document.getElementById('pagination').innerHTML = paginationHTML;
    }

    function changePage(page) {
        currentPage = page;
        renderProducts();
        renderPagination();
    }

    function openEditModal(productId) {
        const product = products.find(p => p.id === productId);
        if (!product) return;

        editingProductId = productId;
        document.getElementById('editProductId').value = product.id;
        document.getElementById('editProductName').value = product.name;
        document.getElementById('editProductPrice').value = product.price;
        document.getElementById('editProductImage').value = product.image;
        document.getElementById('editProductCategory').value = product.category;
        document.getElementById('editProductDescription').value = product.description || "";

        document.getElementById('editModal').classList.add('active');
    }

    function closeEditModal() {
        document.getElementById('editModal').classList.remove('active');
        editingProductId = null;
    }

    // --- ELIMINAR PRODUCTO ---
    async function deleteProduct() {
        if (editingProductId && confirm('¬øEst√°s seguro de que quieres eliminar este producto?')) {
            const productIndex = products.findIndex(p => p.id === editingProductId);
            if (productIndex !== -1) {
                products.splice(productIndex, 1);
                await saveData(); // Guardar cambios tras eliminar
                renderProducts();
                renderPagination();
                closeEditModal();
            }
        }
    }

    // Funciones del carrito
    function addToCart(productId) {
        const product = products.find(p => p.id === productId);
        if (!product) return;

        const existingItem = cart.find(item => item.id === productId);
        if (existingItem) {
            existingItem.quantity += 1;
        } else {
            cart.push({
                ...product,
                quantity: 1
            });
        }

        updateCartDisplay();

        const btn = event.target;
        const originalText = btn.innerHTML;
        btn.innerHTML = '‚úÖ ¬°Agregado!';
        btn.style.background = '#27ae60';

        setTimeout(() => {
            btn.innerHTML = originalText;
            btn.style.background = '';
        }, 1500);
    }

    function removeFromCart(productId) {
        cart = cart.filter(item => item.id !== productId);
        updateCartDisplay();
        renderCart();
    }

    function updateQuantity(productId, change) {
        const item = cart.find(item => item.id === productId);
        if (item) {
            item.quantity += change;
            if (item.quantity <= 0) {
                removeFromCart(productId);
            } else {
                updateCartDisplay();
                renderCart();
            }
        }
    }

    function updateCartDisplay() {
        const cartCount = document.getElementById('cartCount');
        const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);

        if (totalItems > 0) {
            cartCount.textContent = totalItems;
            cartCount.style.display = 'flex';
        } else {
            cartCount.style.display = 'none';
        }
    }

    function toggleCart() {
        const cartModal = document.getElementById('cartModal');
        cartModal.classList.add('active');
        renderCart();
    }

    function closeCart() {
        document.getElementById('cartModal').classList.remove('active');
    }

    function renderCart() {
        const cartItems = document.getElementById('cartItems');
        const cartTotal = document.getElementById('cartTotal');
        const cartActions = document.getElementById('cartActions');

        if (cart.length === 0) {
            cartItems.innerHTML = '<div class="empty-cart">üõí Tu carrito est√° vac√≠o</div>';
            cartTotal.style.display = 'none';
            cartActions.style.display = 'none';
            return;
        }

        const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

        cartItems.innerHTML = cart.map(item => `
            <div class="cart-item">
                <img src="${item.image}" alt="${item.name}" class="cart-item-image">
                <div class="cart-item-info">
                    <div class="cart-item-name">${item.name}</div>
                    <div class="cart-item-price">${item.price.toLocaleString('es-CO', {minimumFractionDigits: 2})} c/u</div>
                </div>
                <div class="quantity-controls">
                    <button class="quantity-btn" onclick="updateQuantity(${item.id}, -1)">-</button>
                    <span class="quantity-display">${item.quantity}</span>
                    <button class="quantity-btn" onclick="updateQuantity(${item.id}, 1)">+</button>
                    <button class="quantity-btn" onclick="removeFromCart(${item.id})" style="background: #c0392b; color: white; margin-left: 10px;">üóëÔ∏è</button>
                </div>
            </div>
        `).join('');

        cartTotal.innerHTML = `Total: ${total.toLocaleString('es-CO', {minimumFractionDigits: 2})}`;
        cartTotal.style.display = 'block';
        cartActions.style.display = 'block';
    }

    function sendToWhatsApp() {
        if (cart.length === 0) {
            alert('Tu carrito est√° vac√≠o');
            return;
        }

        const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

        let message = 'üíé *NUEVO PEDIDO - TRENDY ALE* ‚ú®\n\n';
        message += '*JOYER√çA DE LUJO & ELEGANCIA*\n\n';
        message += '*PRODUCTOS SELECCIONADOS:*\n';

        cart.forEach(item => {
            message += `‚ñ™Ô∏è ${item.name}\n`;
            message += `   üí∞ ${item.price.toLocaleString('es-CO', {minimumFractionDigits: 2})} c/u\n`;
            message += `   üì¶ Cantidad: ${item.quantity}\n`;
            message += `   üíµ Subtotal: ${(item.price * item.quantity).toLocaleString('es-CO', {minimumFractionDigits: 2})}\n\n`;
        });

        message += `üí∞ *TOTAL: ${total.toLocaleString('es-CO', {minimumFractionDigits: 2})}*\n\n`;
        message += '¬°Hola! Me interesa adquirir estos productos de joyer√≠a. ¬øPodr√≠as proporcionarme informaci√≥n sobre disponibilidad, m√©todos de pago y tiempos de entrega? ‚ú®';

        const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;
        window.open(whatsappUrl, '_blank');

        cart = []; // Limpiar el carrito despu√©s de enviar
        updateCartDisplay();
        closeCart();
    }

    // --- SUBIR IMAGEN DESDE ARCHIVO ---
    let uploadedImageBase64 = "";
    document.getElementById('productImageFile').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) {
            uploadedImageBase64 = "";
            return;
        }
        const reader = new FileReader();
        reader.onload = function(evt) {
            uploadedImageBase64 = evt.target.result;
        };
        reader.readAsDataURL(file);
    });

    // --- SUBIR IMAGEN DESDE ARCHIVO AL EDITAR ---
    let editUploadedImageBase64 = "";
    document.getElementById('editProductImageFile').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) {
            editUploadedImageBase64 = "";
            return;
        }
        const reader = new FileReader();
        reader.onload = function(evt) {
            editUploadedImageBase64 = evt.target.result;
        };
        reader.readAsDataURL(file);
    });

    // --- AGREGAR PRODUCTO ---
    document.getElementById('productForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        let imageUrl = document.getElementById('productImage').value;
        if (uploadedImageBase64) {
            imageUrl = uploadedImageBase64;
        } else if (!imageUrl) {
            imageUrl = 'https://via.placeholder.com/280x250/f0f0f0/999?text=Nueva+Imagen';
        }

        const newProduct = {
            id: Date.now(), // Usar timestamp como ID temporal hasta que el servidor asigne uno
            name: document.getElementById('productName').value,
            price: parseFloat(document.getElementById('productPrice').value),
            image: imageUrl,
            category: document.getElementById('productCategory').value.toLowerCase(),
            description: document.getElementById('productDescription').value
        };

        products.push(newProduct);
        await saveData(); // Guardar el nuevo producto
        renderProducts();
        renderPagination();
        this.reset();
        uploadedImageBase64 = "";
    });

    // --- EDITAR PRODUCTO ---
    document.getElementById('editForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const productIndex = products.findIndex(p => p.id === editingProductId);
        if (productIndex !== -1) {
            let imageUrl = document.getElementById('editProductImage').value;
            if (editUploadedImageBase64) {
                imageUrl = editUploadedImageBase64;
            }

            products[productIndex] = {
                ...products[productIndex],
                name: document.getElementById('editProductName').value,
               price: parseFloat(document.getElementById('editProductPrice').value),
               image: imageUrl,
               category: document.getElementById('editProductCategory').value.toLowerCase(),
               description: document.getElementById('editProductDescription').value
           };

           await saveData(); // Guardar los cambios
           renderProducts();
           renderPagination();
           closeEditModal();
           editUploadedImageBase64 = "";
       }
   });

   // --- LOGIN ADMIN ---
   document.getElementById('adminLoginForm').addEventListener('submit', function(e) {
       e.preventDefault();
       const user = document.getElementById('adminUser').value;
       const pass = document.getElementById('adminPass').value;

       // Credenciales de administrador (cambiar por las deseadas y/o implementar un sistema de autenticaci√≥n m√°s robusto)
       if (user === 'admin' && pass === 'trendy2024') {
           isAdminMode = true;
           document.getElementById('adminPanel').classList.add('active');
           document.body.classList.add('admin-mode');
           closeAdminLogin();
           updateAdminButton();
           renderProducts(); // Renderizar de nuevo para mostrar botones de edici√≥n

           // Cargar configuraci√≥n guardada al iniciar sesi√≥n
           const savedNumber = document.getElementById('whatsappNumber').value;
           if (savedNumber) {
               whatsappNumber = savedNumber;
           }
       } else {
           document.getElementById('adminLoginError').style.display = 'block';
           setTimeout(() => {
               document.getElementById('adminLoginError').style.display = 'none';
           }, 3000);
       }
   });

   function closeAdminLogin() {
       document.getElementById('adminLoginModal').classList.remove('active');
       document.getElementById('adminLoginForm').reset();
   }

   // --- CONFIGURACI√ìN WHATSAPP ---
   document.getElementById('whatsappNumber').addEventListener('change', async function() {
       whatsappNumber = this.value;
       await saveData(); // Guardar el n√∫mero de WhatsApp si cambia
   });

   // --- INICIALIZACI√ìN ---
   document.addEventListener('DOMContentLoaded', async function() {
       await loadFromDatabase(); // Intentar cargar desde el servidor primero
       loadDataFromStorage(); // Si falla o no hay datos, cargar desde localStorage
       renderProducts();
       renderPagination();
       updateCartDisplay();
   });

   // --- CERRAR MODALES AL HACER CLICK FUERA ---
   document.addEventListener('click', function(e) {
       if (e.target.classList.contains('modal')) {
           e.target.classList.remove('active');
       }
       if (e.target.classList.contains('cart-modal')) {
           e.target.classList.remove('active');
       }
   });

   // --- ATAJOS DE TECLADO ---
   document.addEventListener('keydown', function(e) {
       if (e.key === 'Escape') {
           document.querySelectorAll('.modal.active').forEach(modal => {
               modal.classList.remove('active');
           });
           document.querySelectorAll('.cart-modal.active').forEach(modal => {
               modal.classList.remove('active');
           });
       }
   });
</script>

</body>
</html>
